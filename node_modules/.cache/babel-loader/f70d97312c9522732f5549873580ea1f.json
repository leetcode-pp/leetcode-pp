{"remainingRequest":"/Users/luxiaopeng/github/leetcode-pp/node_modules/thread-loader/dist/cjs.js!/Users/luxiaopeng/github/leetcode-pp/node_modules/babel-loader/lib/index.js!/Users/luxiaopeng/github/leetcode-pp/node_modules/eslint-loader/index.js??ref--13-0!/Users/luxiaopeng/github/leetcode-pp/src/apis/request.js","dependencies":[{"path":"/Users/luxiaopeng/github/leetcode-pp/src/apis/request.js","mtime":1648364288714},{"path":"/Users/luxiaopeng/github/leetcode-pp/node_modules/cache-loader/dist/cjs.js","mtime":1582876651155},{"path":"/Users/luxiaopeng/github/leetcode-pp/node_modules/thread-loader/dist/cjs.js","mtime":1582876651885},{"path":"/Users/luxiaopeng/github/leetcode-pp/node_modules/babel-loader/lib/index.js","mtime":1614915260754},{"path":"/Users/luxiaopeng/github/leetcode-pp/node_modules/eslint-loader/index.js","mtime":1584094539526}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0ICJhbnQtZGVzaWduLXZ1ZS9lcy9tZXNzYWdlL3N0eWxlIjsKaW1wb3J0IF9tZXNzYWdlIGZyb20gImFudC1kZXNpZ24tdnVlL2VzL21lc3NhZ2UiOwppbXBvcnQgX29iamVjdFNwcmVhZCBmcm9tICIvVXNlcnMvbHV4aWFvcGVuZy9naXRodWIvbGVldGNvZGUtcHAvbm9kZV9tb2R1bGVzL0BiYWJlbC9ydW50aW1lL2hlbHBlcnMvZXNtL29iamVjdFNwcmVhZDIiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5jb25jYXQuanMiOwppbXBvcnQgYXhpb3MgZnJvbSAnYXhpb3MnOwppbXBvcnQgeyBob3N0bmFtZSB9IGZyb20gJ0AvY29uZmlnL2luZGV4JzsgLy8gYXN5bmMgZnVuY3Rpb24gZ2V0QXZhbGlhYmxlSG9zdChpID0gMCkgewovLyAgIGlmIChpIDwgaG9zdG5hbWVQb29sLmxlbmd0aCkgewovLyAgICAgcmV0dXJuIGZldGNoKGhvc3RuYW1lUG9vbFtpXSkKLy8gICAgICAgLnRoZW4oKCkgPT4gaG9zdG5hbWVQb29sW2ldKQovLyAgICAgICAuY2F0Y2goZXJyID0+IHsKLy8gICAgICAgICBpZiAoZXJyLm1lc3NhZ2UgPT09ICdOZXR3b3JrIEVycm9yJykgewovLyAgICAgICAgICAgcmV0dXJuIGdldEF2YWxpYWJsZUhvc3QoaSArIDEpCi8vICAgICAgICAgfQovLyAgICAgICB9KQovLyAgIH0KLy8gICByZXR1cm4gLTEKLy8gfQoKdmFyIGhvc3QgPSBwcm9jZXNzLmVudi5OT0RFX0VOViA9PT0gJ3Byb2R1Y3Rpb24nID8gImh0dHBzOi8vIi5jb25jYXQoaG9zdG5hbWUpIDogJ2h0dHA6Ly9sb2NhbGhvc3Q6MzAwMCc7CnZhciBwcm9taXNlUG9vbCA9IHt9OwpleHBvcnQgZGVmYXVsdCBmdW5jdGlvbiAoKSB7CiAgdmFyIF90b2tlbjsKCiAgdmFyIG9wdGlvbnMgPSBhcmd1bWVudHMubGVuZ3RoID4gMCAmJiBhcmd1bWVudHNbMF0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1swXSA6IHt9OwogIHZhciB1cmwgPSAiIi5jb25jYXQoaG9zdCkuY29uY2F0KG9wdGlvbnMudXJsKTsKICB2YXIgY2FuID0gIW9wdGlvbnMubWV0aG9kIHx8IG9wdGlvbnMubWV0aG9kLnRvVXBwZXJDYXNlKCkgPT09ICdHRVQnOwogIHZhciBrID0gJyc7CgogIGlmIChjYW4pIHsKICAgIGsgPSAiIi5jb25jYXQodXJsLCAiLSIpLmNvbmNhdChKU09OLnN0cmluZ2lmeShvcHRpb25zLnBhcmFtcykpOwoKICAgIGlmIChrIGluIHByb21pc2VQb29sKSB7CiAgICAgIHJldHVybiBwcm9taXNlUG9vbFtrXTsKICAgIH0KICB9CgogIHZhciBvcmlnaW5hbEhlYWRlcnMgPSBvcHRpb25zLmhlYWRlcnMgfHwge307CiAgdmFyIHRva2VuID0gbnVsbDsKCiAgdHJ5IHsKICAgIHRva2VuID0gSlNPTi5wYXJzZSh3aW5kb3cubG9jYWxTdG9yYWdlLmdldEl0ZW0oJ3Rva2VuJykpOwogIH0gY2F0Y2ggKGVycikge30KCiAgaWYgKHRva2VuICYmIG5ldyBEYXRlKCkuZ2V0VGltZSgpID49IHRva2VuLmV4cGlyZUF0KSB7CiAgICB3aW5kb3cubG9jYWxTdG9yYWdlLnJlbW92ZUl0ZW0oJ3Rva2VuJyk7CiAgfQoKICB2YXIgcCA9IGF4aW9zKF9vYmplY3RTcHJlYWQoX29iamVjdFNwcmVhZCh7fSwgb3B0aW9ucyksIHt9LCB7CiAgICBoZWFkZXJzOiBfb2JqZWN0U3ByZWFkKF9vYmplY3RTcHJlYWQoe30sIG9yaWdpbmFsSGVhZGVycyksIHt9LCB7CiAgICAgIHRva2VuOiAoKF90b2tlbiA9IHRva2VuKSA9PT0gbnVsbCB8fCBfdG9rZW4gPT09IHZvaWQgMCA/IHZvaWQgMCA6IF90b2tlbi52YWx1ZSkgfHwgJ2VtcHR5JwogICAgfSksCiAgICB3aXRoQ3JlZGVudGlhbHM6IHRydWUsCiAgICB1cmw6IHVybAogIH0pKS50aGVuKGZ1bmN0aW9uIChyZXMpIHsKICAgIHJldHVybiByZXMuZGF0YTsKICB9KS50aGVuKGZ1bmN0aW9uIChyZXMpIHsKICAgIGlmIChyZXMuc3VjY2VzcykgcmV0dXJuIHJlcy5kYXRhOwogICAgdGhyb3cgcmVzOwogIH0pLmNhdGNoKGZ1bmN0aW9uIChlcnIpIHsKICAgIF9tZXNzYWdlLmVycm9yKGVyci5tZXNzYWdlIHx8ICfns7vnu5/lvIDlsI/lt65+Jyk7CgogICAgdGhyb3cgZXJyOwogIH0pOwoKICBpZiAoY2FuKSB7CiAgICBwcm9taXNlUG9vbFtrXSA9IHA7CiAgfQoKICByZXR1cm4gcDsKfQ=="},{"version":3,"sources":["/Users/luxiaopeng/github/leetcode-pp/src/apis/request.js"],"names":["axios","hostname","host","process","env","NODE_ENV","promisePool","options","url","can","method","toUpperCase","k","JSON","stringify","params","originalHeaders","headers","token","parse","window","localStorage","getItem","err","Date","getTime","expireAt","removeItem","p","value","withCredentials","then","res","data","success","catch","error","message"],"mappings":";;;;AACA,OAAOA,KAAP,MAAkB,OAAlB;AACA,SAASC,QAAT,QAAyB,gBAAzB,C,CAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,IAAMC,IAAI,GACRC,OAAO,CAACC,GAAR,CAAYC,QAAZ,KAAyB,YAAzB,qBACeJ,QADf,IAEI,uBAHN;AAIA,IAAMK,WAAW,GAAG,EAApB;AACA,eAAe,YAAuB;AAAA;;AAAA,MAAdC,OAAc,uEAAJ,EAAI;AACpC,MAAMC,GAAG,aAAMN,IAAN,SAAaK,OAAO,CAACC,GAArB,CAAT;AACA,MAAMC,GAAG,GAAG,CAACF,OAAO,CAACG,MAAT,IAAmBH,OAAO,CAACG,MAAR,CAAeC,WAAf,OAAiC,KAAhE;AACA,MAAIC,CAAC,GAAG,EAAR;;AACA,MAAIH,GAAJ,EAAS;AACPG,IAAAA,CAAC,aAAMJ,GAAN,cAAaK,IAAI,CAACC,SAAL,CAAeP,OAAO,CAACQ,MAAvB,CAAb,CAAD;;AACA,QAAIH,CAAC,IAAIN,WAAT,EAAsB;AACpB,aAAOA,WAAW,CAACM,CAAD,CAAlB;AACD;AACF;;AACD,MAAMI,eAAe,GAAGT,OAAO,CAACU,OAAR,IAAmB,EAA3C;AACA,MAAIC,KAAK,GAAG,IAAZ;;AACA,MAAI;AACFA,IAAAA,KAAK,GAAGL,IAAI,CAACM,KAAL,CAAWC,MAAM,CAACC,YAAP,CAAoBC,OAApB,CAA4B,OAA5B,CAAX,CAAR;AACD,GAFD,CAEE,OAAOC,GAAP,EAAY,CAEb;;AAED,MAAIL,KAAK,IAAI,IAAIM,IAAJ,GAAWC,OAAX,MAAwBP,KAAK,CAACQ,QAA3C,EAAqD;AACnDN,IAAAA,MAAM,CAACC,YAAP,CAAoBM,UAApB,CAA+B,OAA/B;AACD;;AAED,MAAMC,CAAC,GAAG5B,KAAK,iCACVO,OADU;AAEbU,IAAAA,OAAO,kCACFD,eADE;AAELE,MAAAA,KAAK,EAAE,WAAAA,KAAK,UAAL,wCAAOW,KAAP,KAAgB;AAFlB,MAFM;AAMbC,IAAAA,eAAe,EAAE,IANJ;AAObtB,IAAAA,GAAG,EAAHA;AAPa,KAAL,CASPuB,IATO,CASF,UAAAC,GAAG;AAAA,WAAIA,GAAG,CAACC,IAAR;AAAA,GATD,EAUPF,IAVO,CAUF,UAAAC,GAAG,EAAI;AACX,QAAIA,GAAG,CAACE,OAAR,EAAiB,OAAOF,GAAG,CAACC,IAAX;AACjB,UAAMD,GAAN;AACD,GAbO,EAcPG,KAdO,CAcD,UAAAZ,GAAG,EAAI;AACZ,aAAQa,KAAR,CAAcb,GAAG,CAACc,OAAJ,IAAe,QAA7B;;AACA,UAAMd,GAAN;AACD,GAjBO,CAAV;;AAkBA,MAAId,GAAJ,EAAS;AACPH,IAAAA,WAAW,CAACM,CAAD,CAAX,GAAiBgB,CAAjB;AACD;;AAED,SAAOA,CAAP;AACD","sourcesContent":["import { message } from 'ant-design-vue'\nimport axios from 'axios'\nimport { hostname } from '@/config/index'\n\n// async function getAvaliableHost(i = 0) {\n//   if (i < hostnamePool.length) {\n//     return fetch(hostnamePool[i])\n//       .then(() => hostnamePool[i])\n//       .catch(err => {\n//         if (err.message === 'Network Error') {\n//           return getAvaliableHost(i + 1)\n//         }\n//       })\n//   }\n//   return -1\n// }\n\nconst host =\n  process.env.NODE_ENV === 'production'\n    ? `https://${hostname}`\n    : 'http://localhost:3000'\nconst promisePool = {}\nexport default function(options = {}) {\n  const url = `${host}${options.url}`\n  const can = !options.method || options.method.toUpperCase() === 'GET'\n  let k = ''\n  if (can) {\n    k = `${url}-${JSON.stringify(options.params)}`\n    if (k in promisePool) {\n      return promisePool[k]\n    }\n  }\n  const originalHeaders = options.headers || {}\n  let token = null\n  try {\n    token = JSON.parse(window.localStorage.getItem('token'))\n  } catch (err) {\n    console.log(err)\n  }\n\n  if (token && new Date().getTime() >= token.expireAt) {\n    window.localStorage.removeItem('token')\n  }\n\n  const p = axios({\n    ...options,\n    headers: {\n      ...originalHeaders,\n      token: token?.value || 'empty'\n    },\n    withCredentials: true,\n    url\n  })\n    .then(res => res.data)\n    .then(res => {\n      if (res.success) return res.data\n      throw res\n    })\n    .catch(err => {\n      message.error(err.message || '系统开小差~')\n      throw err\n    })\n  if (can) {\n    promisePool[k] = p\n  }\n\n  return p\n}\n"]}]}